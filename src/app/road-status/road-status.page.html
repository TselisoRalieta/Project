<ion-header>
  <ion-toolbar style="--background: #ffffff;">
    <ion-col size="auto" class="top-icons" style="display: flex; align-items: center; justify-content: flex-end; padding: 0;">
      <ion-buttons>
        <ion-button [routerLink]="['/report']">
          <ion-icon name="triangle-outline" size="large" style="color: #3e3e3e;"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-col>
  </ion-toolbar>
</ion-header>

<ion-content style="--background: #ffffff; color: #3e3e3e;">
  <!-- Pull to refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="ngOnInit(); $event.target.complete()">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- View on Map Button -->
  <ion-item lines="none" style="--background: transparent;">
    <ion-button 
      expand="block" 
      style="--background: #007bff; --color: #ffffff; margin: 16px;"
      (click)="navigateToMap()">
      <ion-icon name="map-outline" slot="start"></ion-icon>
      View Hazards on Map
    </ion-button>
  </ion-item>

  <!-- Hazards list -->
  <ion-grid *ngIf="!loading && hazards.length > 0" class="hazard-grid">
    <ion-row>
      <ion-col size="12" size-md="6" size-lg="4" *ngFor="let hazard of hazards">
        <ion-card>
          <ion-card-header>
            <ion-card-title>
              {{ hazard.type | titlecase }} ({{ hazard.severity }})
            </ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <p>{{ hazard.description }}</p>
            <p><b>Source:</b> {{ hazard.source }}</p>
            <p><b>Time:</b> {{ hazard.timestamp | date:'short' }}</p>
            <p><b>Location:</b> {{ hazard.location.district }}, {{ hazard.location.village }}</p>
            
            <!-- AI PREDICTION SECTION -->
            <ion-item lines="none" style="--background: #e8f4ff; border-radius: 8px; margin: 10px 0; padding: 10px;">
              <ion-icon name="time-outline" slot="start" style="color: #007bff; font-size: 24px;"></ion-icon>
              <ion-label style="white-space: normal;">
                <h3 style="color: #007bff; font-weight: bold; margin: 0 0 8px 0; font-size: 14px;">
                  CLEARANCE PREDICTION
                </h3>
                <p style="margin: 4px 0; font-size: 13px; font-weight: 500;">
                  <strong>Estimated Clearance:</strong> {{ hazard.predictedClearanceTime || 'Calculating...' }}
                </p>
                <p style="margin: 4px 0; font-size: 12px; color: #666;">
                  <strong>Confidence:</strong> 
                  <ion-badge color="primary" style="margin-left: 5px; font-size: 11px;">
                    {{ getPredictionConfidence(hazard) }}%
                  </ion-badge>
                </p>
                <p *ngIf="hazard.factorsUsed && hazard.factorsUsed.length > 0" 
                   style="margin: 4px 0; font-size: 11px; color: #888; line-height: 1.3;">
                  <strong>Factors:</strong> {{ hazard.factorsUsed.join(', ') }}
                </p>
                <p *ngIf="hazard.estimatedClearanceTimestamp" 
                   style="margin: 4px 0; font-size: 11px; color: #007bff; font-weight: 500;">
                  <ion-icon name="calendar-outline" style="vertical-align: middle;"></ion-icon>
                  Expected by: {{ hazard.estimatedClearanceTimestamp | date:'short' }}
                </p>
              </ion-label>
            </ion-item>

            <ion-item lines="none" style="display: flex; align-items: center; justify-content: space-between; --background: #f2f2f2; font-weight: bold; border-radius: 8px;">
              <ion-label style="color: #3e3e3e; align-items: center">Status</ion-label>
              <ion-badge
                [color]="hazard.status === 'Resolved' ? 'success' : hazard.status === 'Verified' ? 'warning' : 'medium'">
                {{ hazard.status }}
              </ion-badge>
            </ion-item>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- Empty state -->
  <ion-item *ngIf="!loading && hazards.length === 0">
    <ion-label>No hazards reported</ion-label>
  </ion-item>

  <!-- Loading spinner -->
  <ion-spinner *ngIf="loading" name="crescent"></ion-spinner>

  <br><br><br><br>

  <!-- Footer -->
  <ion-footer class="tab-bar">
    <ion-toolbar>
      <ion-buttons slot="start" class="footer-buttons">
        <ion-button [routerLink]="['/dashbourd']">
          <ion-icon name="home-outline"></ion-icon>
          HOME
        </ion-button>

        <ion-button [routerLink]="['/about-us']">
          <ion-icon name="people-outline"></ion-icon>
          About Us
        </ion-button>

        <ion-button [routerLink]="['/settings']">
          <ion-icon name="settings-outline"></ion-icon>
          Settings
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-footer>
</ion-content>